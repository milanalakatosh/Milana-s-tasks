<!DOCTYPE html>
<html>
    <head>
        <title>HTML-junior</title>
    </head>
    <body>
        <h1>Сравнение открытых OLAP-систем Big Data: ClickHouse, Druid и Pinot</h1>
        <p>
            Оригинал - https://medium.com/@leventov/comparison-of-the-open-source-olap-systems-for-big-data-clickhouse-druid-and-pinot-8e042a5ed1c7
        </p>
        <p>
            <a href="https://clickhouse.tech/">ChlickHouse</a>, <a href="https://druid.apache.org/">Druid</a> и 
            <a href="https://github.com/apache/pinot">Pinot</a> – три открытых хранилища данных, 
            которые позволяют выполнять аналитические запросы на больших объемах данных с интерактивными 
            задержками. Эта статья - перевод 
            <a href="https://leventov.medium.com/comparison-of-the-open-source-olap-systems-for-big-data-clickhouse-druid-and-pinot-8e042a5ed1c7">подробного сравнения</a>
            , выполненного Романом Левентовым.
        </p>
        <h3>Источники информации</h3>
        <p>
            Подробности реализации <b>ClickHouse</b> стали мне известны от 
            <a href="https://github.com/ztlpn">Алексея Зателепина</a>, одного из <b>ключевых 
            разработчиков проекта</b>. Доступная на английском документация достаточно скудна – 
            наилучшим источником информации служат последние четыре секции 
            <a href="https://clickhouse.tech/docs/en/development/architecture.html">данной страницы документации</a>.
        </p>
        <p>
            <b>Я сам участвую в развитии Druid</b>, но у меня нет личной заинтересованности в этой системе - 
            по правде говоря, скорее всего в ближайшее время я перестану заниматься её разработкой. 
            Поэтому читатели могут рассчитывать на отсутствие какой-либо предвзятости.
        </p>
        <p>
            Всё, что я буду далее писать про <b>Pinot</b>, основывается на странице 
            <a href="https://github.com/apache/pinot/wiki">Архитектура в вики Pinot</a>, 
            а также на других страницах вики в разделе “Проектная документация”. 
            Последний раз они обновлялись в июне 2017 года - больше, чем полгода назад.
        </p>
        <p>
            Рецензентами оригинальной статьи стали Алексей Зателепин и 
            <a href="https://github.com/ludv1x">Виталий Людвиченко</a> (разработчики ClickHouse), 
            <a href="https://github.com/gianm">Жан Мерлино</a> (самый активный разработчик Druid), 
            <a href="https://github.com/kishoreg">Кишор Гопалакришна</a> (архитектор Pinot) и 
            <a href="https://github.com/jfim">Жан-Француа Им</a> (разработчик Pinot). 
            Мы присоединяемся к благодарности автора и полагаем, что это многократно повышает авторитетность статьи.
        </p>
        <p>
            <b>Предупреждение</b>: статья достаточно большая, поэтому вполне возможно вы 
            захотите ограничиться прочтением раздела “Заключение” в конце.
        </p>
        <h2>Сходства между системами</h2>
        <h3>Связанные данные и вычисления </h3>
        <p>
            <b>На фундаментальном уровне, ClickHouse, Druid и Pinot похожи</b>, 
            поскольку они хранят данные и выполняют обработку запросов на одних и тех же узлах, 
            уходя от “разъединенной” архитектуры BigQuery. Недавно я уже описывал несколько 
            наследственных проблем со связанной архитектурой в случае Druid [
            <a href="https://leventov.medium.com/the-problems-with-druid-at-large-scale-and-high-load-part-1-714d475e84c9">1</a>, 
            <a href ="https://leventov.medium.com/the-challenges-of-running-druid-at-large-scale-and-future-directions-part-2-ef594ce298f2">2</a>]. 
            Открытого эквивалента для BigQuery на данный момент не существует (за исключением, разве что, 
            <a href="http://drill.apache.org/">Drill</a>?) Возможным подходам к построению подобных 
            открытых систем посвящена 
            <a href="https://leventov.medium.com/design-of-a-cost-efficient-time-series-store-for-big-data-88c5dc41af8e">
                другая статье в моем блоге</a>.
        </p>
        <h3>Отличия от Big Data SQL-систем: индексы и статическое распределение данных</h3>
        <p>
            Рассматриваемые в этой статье системы <b>выполняют запросы быстрее</b>, чем системы Big Data 
            из семейства класса SQL-on-Hadoop: Hive, Impala, Presto и Spark, даже когда последние 
            получают доступ к данным, хранящимся в колоночном формате - к примеру, Parquet или Kudu. 
            Это происходит потому, что в ClickHouse, Druid и Pinot:
        </p>
        <p>
            <ul>
                <li>
                    Имеется свой <b>собственный формат для хранения данных с индексами</b>, 
                    и они тесно интегрированы с движками обработки запросов. Системы класса 
                    SQL-on-Hadoop обычно можно назвать агностиками относительно форматов данных 
                    и поэтому они менее “навязчивы” в бэкендах Big Data.
                </li>
                <li>
                    <b>Данные распределены относительно “статично”</b> между узлами, и при 
                    распределенном выполнении запроса это можно использовать. Обратная сторона 
                    медали при этом в том, что ClickHouse, Druid и Pinot <b>не поддерживают 
                    запросы, которые требуют перемещения большого количества данных</b> 
                    между узлами - к примеру, join между двумя большими таблицами.

                </li>
            </ul>
        </p>
        <h3>Отсутствие точечных обновлений и удалений</h3>
        <p>
            Находясь на другой стороне спектра баз данных, ClickHouse, Druid и Pinot 
            <b>не поддерживают точечные обновления и удаления</b>, в противоположность 
            колоночным системам вроде Kudu, InfluxDB и Vertica (?). Это даёт ClickHouse, Druid и 
            Pinot возможность производить более эффективное колоночное сжатие и более агрессивные 
            индексы, что означает <b>большую эффективность использования ресурсов</b> и быстрое 
            выполнение запросов.
        </p>
        <p>
            Разработчики ClickHouse в Yandex планируют начать поддерживать 
            <a href="https://clickhouse.tech/docs/en/roadmap.html#q1-2018">обновления и удаления 
            в будущем</a>, но я не уверен, будут ли это “настоящие” точечные запросы или 
            обновления/удаления диапазонов данных.
        </p>
        <h3>Поглощение в стиле Big Data</h3>
        <p>
            Все три системы поддерживают потоковое поглощение данных из Kafka. Druid и Pinot 
            поддерживают потоковую передачу данных стриминг в 
            <a href="https://en.wikipedia.org/wiki/Lambda_architecture">Лямбда-стиле</a>
            и пакетное поглощение одних и тех же данных. ClickHouse поддерживает пакетные 
            вставки напрямую, поэтому ему не требуется отдельная система пакетного поглощения 
            подобная той, что используется в Druid и Pinot. Если вас интересуют подробности, 
            то их вы сможете найти далее.
        </p>
        <!--4я страница-->
        <h3>CloudFlare: ClickHouse против Druid</h3>
        <p>
            Одним таким примером, хорошо иллюстрирующим описанную выше проблему, является пост Марека Вавруша о  
            <a href="https://blog.cloudflare.com/how-cloudflare-analyzes-1m-dns-queries-per-second/#comment-3302778860">
            выборе между ClickHouse и Druid в Cloudflare</a>. Им потребовалось 4 сервера ClickHouse 
            (которые со временем превратились в 9), и по их оценкам, для разворачивания аналогичной 
            установки Druid им бы потребовались “сотни узлов”. Пусть Марек и признает, что 
            <b>сравнение является нечестным</b>, поскольку Druid недостаёт “сортировки по первичному 
            ключу”, он возможно даже не осознает, что достичь примерно того же самого эффекта в Druid 
            возможно просто <a href="http://druid.io/docs/0.11.0/ingestion/index.html">установив 
            правильный порядок измерений в “ingestion spec”</a> и произведя простую подготовку данных: 
            обрезать значение колонки <code>__time</code> в Druid до 
            некоей грубой детализации (к примеру, один час) и опционально добавить другую “длинно-типовую” 
            колонку “precise_time”, если для некоторых запросов требуются более точные временные рамки. 
            Да, это хак, но, как мы только что выяснили, и в Druid можно сортировать данные по какому-либо 
            измерению перед <code>__time</code>, и это достаточно просто реализовать.
        </p>
        <p>
            Впрочем, я не стану спорить с их итоговым решением выбрать ClickHouse, поскольку на 
            масштабе примерно в 10 узлов и для их нужд ClickHouse мне тоже кажется лучшим выбором, 
            чем Druid. Но сделанное ими заключение о том, что ClickHouse как минимум на порядок 
            эффективнее (по меркам стоимости инфраструктуры), чем Druid - это серьезное заблуждение. 
            На самом деле, из рассматриваемых нами сегодня систем, <b>Druid предлагает наилучшую 
            возможность для реально дешевых установок</b> (смотрите раздел “Уровни узлов обработки 
            запросов в Druid ” ниже).
        </p>
        <p>
            <mark>
                Когда вы выбираете систему OLAP Big Data, не сравнивайте то, насколько они сейчас 
                хорошо подходят для вашего случая. Сейчас они все субоптимальны. Вместо этого, 
                сравните, насколько быстро ваша компания способна заставить двигаться эти системы 
                в том направлении, которое нужно именно вам.
            </mark>
        </p>
        <p>
            В силу своей фундаментальной архитектурной схожести, ClickHouse, Druid и Pinot имеют 
            примерно один и тот же “предел” эффективности и оптимизации производительности. Здесь нет 
            “волшебной таблетки”, которая позволила бы какой-либо из этих систем быть быстрее, чем 
            остальные. Не позволяйте запутать себя тем фактом, что <i>в своем текущем состоянии</i> 
            системы показывают себя очень по-разному в различных бенчмарках. 
        </p>
        <p>
            Допустим, Druid не поддерживает “сортировку по первичному ключу” настолько хорошо, 
            насколько это умеет ClickHouse - а ClickHouse в свою очередь не поддерживает 
            “инвертированные индексы” столь же хорошо, как Druid, что дает данным системам 
            преимущества с той или иной нагрузкой. <b>Упущенные оптимизации могут быть реализованы 
            в выбранной системе при помощи не таких уж и больших усилий</b>, если у вас есть 
            намерение и возможность решиться на подобный шаг.
        </p>
        <p>
            <ul>
                <li>
                    В вашей организации должны быть инженеры, способные прочитать, понять и 
                    модифицировать исходный код выбранной системы, к тому же у них должно быть 
                    на это время. Заметьте, что ClickHouse написан на C++, а Druid и Pinot —  
                    на Java.
                </li>
            </ul>
        </p>
    </body>
</html>